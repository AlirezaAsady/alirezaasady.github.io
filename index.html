<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تبدیل متن</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --text:#e6eef8; --muted:#9aa6b2; --accent:#10b981;
    }
    *{box-sizing:border-box;font-family:"Segoe UI",Tahoma,Arial;}
    body{margin:0; min-height:100vh; background:#001d4c; color:var(--text);
         display:flex; align-items:center; justify-content:center; padding:10px;}
    .wrap{width:100%; max-width:980px; background:#0b1220; border-radius:12px;
          padding:18px; box-shadow:0 8px 30px rgba(2,6,23,0.6);
          border:1px solid rgba(255,255,255,0.03);}
    header{margin-bottom:12px;}
    h1{margin:0;}
    p.lead{margin:0;color:var(--muted);}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;}
    textarea{width:100%; height:240px; padding:12px; resize:vertical; min-height:140px;
             background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);
             color:var(--text); border-radius:8px; line-height:1.5; margin-top: 8px;}
    .controls{display:flex; flex-direction:column; gap:10px; max-width: 100%;}
    input[type="text"]{padding:8px 10px; border-radius:8px;
                       border:1px solid rgba(255,255,255,0.1); background:transparent;
                       color:var(--text);}
    button{background:var(--accent); color:#012020; padding:10px 12px;
           border-radius:8px; border:none; cursor:pointer; font-weight:600}
    button.secondary{background:transparent; color:var(--text);
                     border:1px solid rgba(255,255,255,0.2)}
    #outputText{height:120px;}
    /* dropdown */
    .dropdown{position:relative; width:100%;}
    .dropdown-btn{background:#0b1220; border:1px solid #333; padding:10px; border-radius:8px;
                  cursor:pointer; user-select:none; display:flex; justify-content:space-between; align-items:center;}
    .dropdown-list{display:none; position:absolute; top:100%; left:0; right:0; background:#0b1220;
                   border:1px solid #333; border-radius:8px; margin-top:4px; max-height:160px;
                   overflow-y:auto; z-index:1000;}
    .dropdown.open .dropdown-list{display:block;}
    .dropdown-item{padding:8px 12px; display:flex; align-items:center; gap:8px; cursor:pointer;}
    .dropdown-item input{pointer-events:none;}
    .dropdown-item:hover{background:#1a2235;}
    .dropdown-item.selected{background: #00175db3; color:#04ff09; font-weight:600;}
    .lead{font-size:13px;}
    .head1{font-size:18px}
    @media (max-width: 720px) {
    .wrap {
        width: 100%;
        max-width: 720px;}
    .lead{font-size:10px;}
    .head1{font-size:12px}
    button{font-size:10px;}
    input{font-size:10px;}
    .dropdown{font-size:10px;}
    .grid{grid-template-columns: 1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 class="head1">تبدیل متن (هر کاراکتر به کاراکتر دیگر)</h1>
      <p class="lead"> (<code>\n</code>) <code>--></code> "_"</p>
    </header>

    <div class="grid">
        <!-- ورودی -->
        <div>
            <label for="inputText">متن ورودی</label>
            <textarea class="lead" id="inputText" placeholder="متن خود را اینجا بچسبانید..."></textarea>
            <div style="display:flex;gap:8px;margin-top:8px;">
            <button id="pasteBtn" class="secondary small">چسباندن</button>
            <button id="clearBtn" class="secondary small">پاک کردن</button>
            </div>
        </div>

        <!-- کنترل‌ها -->
        <div class="controls">
            <!-- انتخاب target و replacement -->
            <div class="lead" style="display:flex; gap:8px; align-items:center;">
            <label for="target">جایگزین کن:</label>
            <input id="target" type="text" value="\n" style="flex:1"
                    title="متن یا کاراکتر اصلی (\\n برای اینتر)" />
            <span class="lead" style="color:#9aa6b2;">→</span>
            <input id="replacement" type="text" value="_" style="flex:1"
                    title="متن یا کاراکتر جایگزین" />
            </div>

            <!-- dropdown گزینه‌ها -->
            <div class="dropdown" id="optionsDropdown">
                <div class="dropdown-btn">انتخاب گزینه‌ها ▾</div>
                <div class="dropdown-list">
                <label class="dropdown-item selected">
                    <input type="checkbox" value="trim" checked>
                    حذف فضاهای اضافی ابتدای/پایان هر خط
                </label>
                <label class="dropdown-item selected">
                    <input type="checkbox" value="squash" checked>
                    جایگزینی چند اینتر متوالی با یک مقدار
                </label>
                <label class="dropdown-item selected">
                    <input type="checkbox" value="preserve" checked>
                    حفظ اینتر انتهای متن (در صورت وجود)
                </label>
                </div>
            </div>


            <div style="display:flex;gap:8px;">
                <button id="convertBtn">تبدیل</button>
                <button id="copyBtn" class="secondary">کپی</button>
                <button id="swapBtn" class="secondary">↔ جابجایی</button>
                <button id="downloadBtn" class="secondary">دانلود .txt</button>
                <button id="convertAllBtn" class="secondary">تبدیل سریع</button>
            </div>

            <div>
                <label for="outputText">نتیجه</label>
                <textarea class="lead" id="outputText"></textarea>
            </div>
        </div>
    </div>
  </div>

  <script>
    const input=document.getElementById('inputText');
    const output=document.getElementById('outputText');
    const target=document.getElementById('target');
    const repl=document.getElementById('replacement');
    const convertBtn=document.getElementById('convertBtn');
    const convertAllBtn=document.getElementById('convertAllBtn');
    const copyBtn=document.getElementById('copyBtn');
    const downloadBtn=document.getElementById('downloadBtn');
    const clearBtn=document.getElementById('clearBtn');
    const pasteBtn=document.getElementById('pasteBtn');
    const swapBtn=document.getElementById('swapBtn');

    // dropdown
    const dropdown=document.getElementById("optionsDropdown");
    const btn=dropdown.querySelector(".dropdown-btn");
    const items=dropdown.querySelectorAll(".dropdown-item");
    btn.addEventListener("click",()=>dropdown.classList.toggle("open"));
    items.forEach(item=>{
      const checkbox=item.querySelector("input");
      item.addEventListener("click",()=>{
        checkbox.checked=!checkbox.checked;
        item.classList.toggle("selected",checkbox.checked);
      });
    });
    document.addEventListener("click",e=>{
      if(!dropdown.contains(e.target)) dropdown.classList.remove("open");
    });

    function selected(v){
      return [...items].some(i=>i.querySelector("input").checked && i.querySelector("input").value===v);
    }

    function replaceCustom(text,targetVal,replacement){
      text=text.replace(/\r\n/g,'\n').replace(/\r/g,'\n');
      if(selected('trim')){
        text=text.split('\n').map(s=>s.trim()).join('\n');
      }
      if(selected('squash')){
        text=text.replace(/\n{2,}/g,'\n');
      }
      // الگوی جستجو
      let searchPattern;
      if(targetVal==="\\n"){ // اگر کاربر \n نوشت
        searchPattern=/\n/g;
      } else if(targetVal===" "){ // اگر اسپیس باشه
        searchPattern=/ /g;
      } else {
        const esc=targetVal.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
        searchPattern=new RegExp(esc,"g");
      }
      return text.replace(searchPattern,replacement);
    }

    convertBtn.addEventListener('click',()=>{
      const t=target.value||"\\n";
      const r=repl.value??'_';
      output.value=replaceCustom(input.value,t,r);
    });
    convertAllBtn.addEventListener('click',()=>convertBtn.click());

    copyBtn.addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText(output.value);
        copyBtn.textContent="Copied ✓";
        setTimeout(()=>copyBtn.textContent="کپی",1200);
      }catch{output.select();document.execCommand("copy");}
    });
    downloadBtn.addEventListener('click',()=>{
      const blob=new Blob([output.value],{type:'text/plain;charset=utf-8'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');a.href=url;a.download='converted.txt';
      document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
    });
    clearBtn.addEventListener('click',()=>{input.value='';output.value='';});
    pasteBtn.addEventListener('click',async()=>{try{input.value=await navigator.clipboard.readText();}catch{alert("کلیپ‌بورد قابل دسترسی نیست.");}});
    swapBtn.addEventListener('click',()=>{const t=input.value;input.value=output.value;output.value=t;});
    document.addEventListener('keydown',e=>{if(e.ctrlKey&&e.key==='Enter'){e.preventDefault();convertBtn.click();}});
  </script>
</body>
</html>
